<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Atify</title>

    <!-- Sekmede de Atify logosu gÃ¶rÃ¼nsÃ¼n -->
    <link rel="icon" type="image/png" href="atify_logo.png">

    <style>
        * { box-sizing: border-box; font-family: Arial, sans-serif; }

        /* ==== ATIFY LOGOSU TADINDA ARKA PLAN ==== */
        body {
            margin: 0;
            color: #e5e7eb;

            /* yeÅŸil Ä±ÅŸÄ±klar + koyu yeÅŸil + siyah geÃ§iÅŸ */
            background:
                radial-gradient(circle at 20% 20%, rgba(90, 255, 120, 0.35), transparent 60%),
                radial-gradient(circle at 80% 30%, rgba(0, 200, 80, 0.25), transparent 55%),
                radial-gradient(circle at 40% 80%, rgba(0, 150, 70, 0.20), transparent 60%),
                linear-gradient(160deg, #03210e 0%, #021509 40%, #000000 100%);
            background-attachment: fixed;
        }

        header {
            background: rgba(17, 24, 39, 0.92);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #1f2937;
            backdrop-filter: blur(6px);
        }
        header h1 {
            font-size: 18px;
            margin: 0;
        }
        nav button {
            margin-right: 6px;
            padding: 6px 10px;
            border-radius: 999px;
            border: none;
            background: #1f2937;
            color: #e5e7eb;
            cursor: pointer;
            font-size: 13px;
        }
        nav button.active {
            background: #22c55e;
            color: #022c22;
            font-weight: 600;
        }
        #userInfo {
            font-size: 12px;
            color: #9ca3af;
            text-align: right;
        }
        #userInfo b { color: #22c55e; }

        main {
            max-width: 960px;
            margin: 20px auto;
            padding: 16px;
            background: rgba(2, 6, 23, 0.92);
            border-radius: 8px;
            border: 1px solid #1f2937;
            backdrop-filter: blur(10px);
        }

        .page { display: none; }
        .page.active { display: block; }

        h2 { margin-top: 0; font-size: 18px; }

        label {
            display: block;
            font-size: 13px;
            margin-top: 8px;
            margin-bottom: 3px;
        }
        input, textarea {
            width: 100%;
            padding: 7px 9px;
            border-radius: 4px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #e5e7eb;
            font-size: 13px;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #22c55e;
        }

        .btn {
            margin-top: 10px;
            padding: 7px 12px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 13px;
        }
        .btn.primary {
            background: #22c55e;
            color: #022c22;
            font-weight: 600;
        }
        .btn.secondary {
            background: #2563eb;
            color: #eff6ff;
        }
        .btn.gray {
            background: #374151;
            color: #e5e7eb;
        }

        .list {
            margin-top: 10px;
            border-radius: 4px;
            border: 1px solid #1f2937;
            padding: 8px;
            max-height: 260px;
            overflow: auto;
            font-size: 13px;
            background: #020617;
        }
        .item {
            padding: 6px 4px;
            border-bottom: 1px solid #111827;
        }
        .item:last-child { border-bottom: none; }
        .item span.tag {
            font-size: 11px;
            padding: 1px 6px;
            border-radius: 999px;
            border: 1px solid #4b5563;
            margin-left: 6px;
            color: #9ca3af;
        }

        #status {
            margin-top: 12px;
            font-size: 12px;
            color: #9ca3af;
        }
        #status span.ok { color: #22c55e; }
        #status span.err { color: #f97316; }

        #popup {
            position: fixed;
            right: 20px;
            bottom: 20px;
            background: #22c55e;
            color: #022c22;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 13px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: none;
            z-index: 9000;
        }

        #authBox {
            margin-top: 16px;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #1f2937;
            background: #020617;
        }
        #authBox h3 {
            font-size: 14px;
            margin: 0 0 4px;
        }
        #authBox small {
            font-size: 11px;
            color: #9ca3af;
        }

        .role-card {
            border-radius: 8px;
            border: 1px solid #1f2937;
            background: #020617;
            padding: 16px;
            flex: 1;
            min-width: 260px;
        }
        .role-title {
            font-size: 16px;
            margin-bottom: 4px;
        }
        .role-badge {
            display: inline-block;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid #4b5563;
            margin-bottom: 8px;
            color: #9ca3af;
        }
        .muted {
            font-size: 12px;
            color: #9ca3af;
        }

        /* ==== GÄ°RÄ°Å / KAYIT MODALI (ORTADA KÃœÃ‡ÃœK ANÄ°MASYON) ==== */
        #roleModalOverlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.55);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9500;
        }
        #roleModal {
            background: #020617;
            border-radius: 12px;
            padding: 16px 20px;
            border: 1px solid #22c55e;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
            width: 280px;
            text-align: center;
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.2s ease-out;
        }
        #roleModal.show {
            transform: scale(1);
            opacity: 1;
        }
        #roleModalTitle {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        #roleModalText {
            font-size: 12px;
            color: #9ca3af;
        }
    </style>
</head>
<body>

<header>
    <!-- LOGOLU HEADER -->
    <div style="display:flex; align-items:center; gap:12px;">
        <!-- atify_logo.png: index.html ile aynÄ± klasÃ¶rde -->
        <img src="atify_logo.png"
             alt="Atify Logo"
             style="height:40px; border-radius:50%; box-shadow:0 0 14px rgba(34,197,94,0.7);">
        <div>
            <h1>Atify</h1>
            <div style="font-size:11px;color:#9ca3af;" id="panelLabel">Admin / KullanÄ±cÄ± Paneli</div>
        </div>
    </div>

    <nav>
        <button data-page="home" data-role="BOTH" class="active" onclick="showPage('home', this)">Ana Sayfa</button>
        <button data-page="songs" data-role="BOTH" onclick="showPage('songs', this)">ÅarkÄ±lar</button>
        <button data-page="artists" data-role="ADMIN" onclick="showPage('artists', this)">SanatÃ§Ä±lar (Admin)</button>
        <button data-page="playlists" data-role="BOTH" onclick="showPage('playlists', this)">Playlistler</button>
        <button data-page="addSong" data-role="ADMIN" onclick="showPage('addSong', this)">MÃ¼zik Ekle (Admin)</button>
    </nav>

    <div id="userInfo">Rol seÃ§ilmedi</div>
</header>

<main>
    <!-- ROL SEÃ‡Ä°M SAYFASI -->
    <section id="page-roleSelect" class="page active">
        <h2>Atifyâ€™e HoÅŸ Geldin ğŸ§</h2>
        <p class="muted">
            Devam etmeden Ã¶nce bu oturumda <b>Admin</b> mi yoksa <b>KullanÄ±cÄ±</b> olarak mÄ± giriÅŸ yapacaÄŸÄ±nÄ± seÃ§.
            (Bu sadece arayÃ¼z yetkilerini belirliyor.)
        </p>
        <div style="display:flex; gap:16px; flex-wrap:wrap; margin-top:12px;">
            <div class="role-card">
                <div class="role-badge">Admin Paneli</div>
                <div class="role-title">Admin GiriÅŸi</div>
                <p class="muted">
                    ÅarkÄ± ekleme, sanatÃ§Ä± ekleme ve tÃ¼m verileri yÃ¶netme yetkisi.
                    Bu ekran ÅŸu an kullandÄ±ÄŸÄ±n â€œyÃ¶netici paneliâ€.
                </p>
                <button class="btn primary" onclick="enterAs('ADMIN')">Admin Olarak Devam Et</button>
            </div>
            <div class="role-card">
                <div class="role-badge">KullanÄ±cÄ± Paneli</div>
                <div class="role-title">KullanÄ±cÄ± GiriÅŸi</div>
                <p class="muted">
                    ÅarkÄ±larÄ± gÃ¶rÃ¼ntÃ¼le, playlist oluÅŸtur, playlistâ€™e ÅŸarkÄ± ekle.
                    ÅarkÄ± ekleme ve sanatÃ§Ä± ekleme <b>adminâ€™e Ã¶zel</b>.
                </p>
                <button class="btn secondary" onclick="enterAs('USER')">KullanÄ±cÄ± Olarak Devam Et</button>
            </div>
        </div>
    </section>

    <!-- ANA SAYFA (ROL SEÃ‡Ä°LDÄ°KTEN SONRA) -->
    <section id="page-home" class="page">
        <h2 id="homeTitle">Panel</h2>
        <p id="homeDesc" style="font-size:13px; color:#e5e7eb;">
            Bu panelde Atify iÃ§in yÃ¶netim ve dinleme iÅŸlemlerini yapabilirsin.
        </p>
        <ul style="font-size:13px; color:#9ca3af;">
            <li><b>ÅarkÄ±lar</b>: TÃ¼m ÅŸarkÄ±larÄ± gÃ¶r.</li>
            <li><b>SanatÃ§Ä±lar</b>: <span id="artistRoleText">YalnÄ±zca adminler sanatÃ§Ä± ekleyebilir.</span></li>
            <li><b>Playlistler</b>: Herkes playlist oluÅŸturabilir ve playlist ekleyebilir.</li>
            <li><b>MÃ¼zik Ekle</b>: Sadece adminler yeni ÅŸarkÄ± ekleyebilir.</li>
        </ul>

        <div id="authBox">
            <h3>GiriÅŸ / KayÄ±t</h3>
            <small>Ä°steklerde JWT kullanmak iÃ§in Ã¶nce kullanÄ±cÄ± oluÅŸturup giriÅŸ yap.</small>

            <div style="display:flex; gap:12px; margin-top:8px; flex-wrap:wrap;">
                <div style="flex:1; min-width:220px;">
                    <h4 style="font-size:13px;margin:0 0 4px;">KayÄ±t Ol (POST /auth/register)</h4>
                    <label>KullanÄ±cÄ± adÄ±</label>
                    <input id="regUsername" type="text" placeholder="username">
                    <label>Email (opsiyonel)</label>
                    <input id="regEmail" type="email" placeholder="tolga@mail.com">
                    <label>Åifre</label>
                    <input id="regPassword" type="password" placeholder="123456">
                    <button class="btn primary" onclick="register()">KayÄ±t Ol</button>
                </div>

                <div style="flex:1; min-width:220px;">
                    <h4 style="font-size:13px;margin:0 0 4px;">GiriÅŸ (POST /auth/login)</h4>
                    <label>KullanÄ±cÄ± adÄ±</label>
                    <input id="loginUsername" type="text" placeholder="username">
                    <label>Åifre</label>
                    <input id="loginPassword" type="password" placeholder="123456">
                    <button class="btn secondary" onclick="login()">GiriÅŸ Yap</button>
                    <button class="btn gray" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
                </div>
            </div>
        </div>
    </section>

    <!-- ÅARKILAR -->
    <section id="page-songs" class="page">
        <h2>ÅarkÄ±lar</h2>
        <button class="btn primary" onclick="getSongs()">ÅarkÄ±larÄ± Getir (GET /songs)</button>
        <div id="songsList" class="list" style="margin-top:10px;">HenÃ¼z ÅŸarkÄ± Ã§ekilmedi.</div>
    </section>

    <!-- SANATÃ‡ILAR (ADMIN) -->
    <section id="page-artists" class="page">
        <h2>SanatÃ§Ä±lar (Admin)</h2>
        <p class="muted">Bu ekran adminlere Ã¶zel. KullanÄ±cÄ±lar yalnÄ±zca liste gÃ¶rebilir (burayÄ± hiÃ§ gÃ¶rmeyecekler).</p>
        <button class="btn primary" onclick="getArtists()">SanatÃ§Ä±larÄ± Getir (GET /artists)</button>
        <div id="artistsList" class="list" style="margin-top:10px;">HenÃ¼z sanatÃ§Ä± Ã§ekilmedi.</div>

        <div id="artistAdminBox">
            <h3 style="margin-top:16px;font-size:15px;">Yeni SanatÃ§Ä± Ekle (POST /artists)</h3>
            <label>SanatÃ§Ä± AdÄ±</label>
            <input id="artistName" type="text" placeholder="Tarkan">
            <button class="btn secondary" onclick="createArtist()">SanatÃ§Ä± Ekle</button>
        </div>
    </section>

    <!-- PLAYLISTLER -->
    <section id="page-playlists" class="page">
        <h2>Playlistler</h2>
        <button class="btn primary" onclick="getPlaylists()">TÃ¼m Playlistleri Getir (GET /playlists)</button>
        <div id="playlistsList" class="list" style="margin-top:10px;">HenÃ¼z playlist Ã§ekilmedi.</div>

        <h3 style="margin-top:16px;font-size:15px;">Playlist OluÅŸtur (POST /playlists)</h3>
        <label>Playlist AdÄ± (name)</label>
        <input id="playlistName" type="text" placeholder="Favorilerim">
        <button class="btn secondary" onclick="createPlaylist()">Playlist OluÅŸtur</button>

        <h3 style="margin-top:16px;font-size:15px;">Playlistâ€™e ÅarkÄ± Ekle</h3>
        <label>Playlist ID</label>
        <input id="plIdForSong" type="number" placeholder="1">
        <label>Song ID</label>
        <input id="plSongId" type="number" placeholder="1">
        <button class="btn secondary" onclick="addSongToPlaylist()">Playlistâ€™e ÅarkÄ± Ekle</button>

        <h3 style="margin-top:16px;font-size:15px;">Playlist Ä°Ã§eriÄŸini Getir</h3>
        <label>Playlist ID</label>
        <input id="plIdForGet" type="number" placeholder="1">
        <button class="btn primary" onclick="getPlaylistContent()">Playlistâ€™i Getir (GET /playlists/{id})</button>
        <div id="playlistContent" class="list" style="margin-top:10px;">HenÃ¼z iÃ§erik Ã§ekilmedi.</div>
    </section>

    <!-- MÃœZÄ°K EKLE (SADECE ADMIN) -->
    <section id="page-addSong" class="page">
        <h2>MÃ¼zik Ekle (Admin â€“ POST /songs)</h2>
        <p style="font-size:13px;color:#9ca3af;margin-top:-4px;">
            Bu ekran yalnÄ±zca adminler iÃ§indir. Backend ÅŸu gÃ¶vdeyi bekliyor:
            <code>{ "name", "artistId", "duration", "playlistIdList" }</code>.
            Sadece <b>name</b> ve <b>artistId</b> zorunlu.
        </p>

        <label>ÅarkÄ± AdÄ± (name)</label>
        <input id="songTitle" type="text" placeholder="Kuzu Kuzu">

        <label>SanatÃ§Ä± ID (artistId)</label>
        <input id="songArtistId" type="number" placeholder="1">

        <label>SÃ¼re (duration, saniye - opsiyonel)</label>
        <input id="songDuration" type="number" placeholder="270">

        <label>Playlist ID Listesi (opsiyonel, virgÃ¼lle ayÄ±r: 1,2,3)</label>
        <input id="songPlaylistIds" type="text" placeholder="">

        <button class="btn primary" onclick="createSong()">ÅarkÄ±yÄ± Kaydet</button>
    </section>

    <div id="status">Durum: Rol seÃ§meni bekliyorum...</div>
</main>

<div id="popup"></div>

<!-- GÄ°RÄ°Å / KAYIT MODALI -->
<div id="roleModalOverlay">
    <div id="roleModal">
        <div style="font-size:26px;margin-bottom:6px;">âœ…</div>
        <div id="roleModalTitle">Ä°ÅŸlem BaÅŸarÄ±lÄ±</div>
        <div id="roleModalText">Atify ile mÃ¼zik keyfine baÅŸlayabilirsin.</div>
    </div>
</div>

<script>
    // ==== CONFIG ====
    const CONFIG = {
        baseUrl: "http://localhost:8080",
        endpoints: {
            register: "/auth/register",
            login: "/auth/login",
            songs: "/songs",
            artists: "/artists",
            playlists: "/playlists"
        }
    };

    let authToken = null;
    let loggedUsername = null;
    let currentRole = null; // "ADMIN" veya "USER"

    function setStatus(msg, ok = true) {
        const el = document.getElementById("status");
        el.innerHTML = `Durum: ${ok ? '<span class="ok">'+msg+'</span>' : '<span class="err">'+msg+'</span>'}`;
    }

    function showPopup(message) {
        const p = document.getElementById("popup");
        p.textContent = message;
        p.style.display = "block";
        setTimeout(() => { p.style.display = "none"; }, 2000);
    }

    // ---- GÄ°RÄ°Å / KAYIT ANÄ°MASYONU ----
    function showAuthModal(mode, username = "") {
        const overlay = document.getElementById("roleModalOverlay");
        const modal   = document.getElementById("roleModal");
        const titleEl = document.getElementById("roleModalTitle");
        const textEl  = document.getElementById("roleModalText");

        if (mode === "register") {
            titleEl.textContent = "KayÄ±t tamamlandÄ± ğŸ§";
            textEl.textContent  = "ArtÄ±k hesabÄ±nla giriÅŸ yapÄ±p istediÄŸin gibi mÃ¼zik dinleyebilirsin.";
        } else if (mode === "login") {
            titleEl.textContent = "GiriÅŸ baÅŸarÄ±lÄ± âœ…";
            textEl.textContent  = (username
                ? `HoÅŸ geldin ${username}, Atify ile mÃ¼zik keyfine devam edebilirsin.`
                : "GiriÅŸ yaptÄ±n, artÄ±k mÃ¼ziklerini dinleyip playlistlerini yÃ¶netebilirsin.");
        } else {
            titleEl.textContent = "Ä°ÅŸlem baÅŸarÄ±lÄ±";
            textEl.textContent  = "Atify ile mÃ¼zik keyfine baÅŸlayabilirsin.";
        }

        overlay.style.display = "flex";
        requestAnimationFrame(() => {
            modal.classList.add("show");
        });

        setTimeout(() => {
            modal.classList.remove("show");
            setTimeout(() => {
                overlay.style.display = "none";
            }, 200);
        }, 1500);
    }

    function updateUserInfo() {
        const el = document.getElementById("userInfo");
        if (!currentRole) {
            el.textContent = "Rol seÃ§ilmedi";
            return;
        }
        const roleText = currentRole === "ADMIN" ? "Admin" : "KullanÄ±cÄ±";
        if (authToken && loggedUsername) {
            el.innerHTML = `Rol: <b>${roleText}</b> | GiriÅŸ yapan: <b>${loggedUsername}</b>`;
        } else {
            el.innerHTML = `Rol: <b>${roleText}</b> | GiriÅŸ yapÄ±lmamÄ±ÅŸ`;
        }
    }

    function applyRoleToUI() {
        const panelLabel = document.getElementById("panelLabel");
        const homeTitle  = document.getElementById("homeTitle");
        const homeDesc   = document.getElementById("homeDesc");
        const artistRoleText = document.getElementById("artistRoleText");
        const artistAdminBox = document.getElementById("artistAdminBox");

        if (currentRole === "ADMIN") {
            panelLabel.textContent = "Admin Paneli";
            homeTitle.textContent  = "Admin Paneli";
            homeDesc.textContent   = "Bu ekran Atify adminleri iÃ§in. ÅarkÄ± ve sanatÃ§Ä± ekleme gibi yÃ¶netim iÅŸlemlerini buradan yapabilirsin.";
            artistRoleText.textContent = "Adminler sanatÃ§Ä± ekleyebilir.";
            if (artistAdminBox) artistAdminBox.style.display = "";
        } else if (currentRole === "USER") {
            panelLabel.textContent = "KullanÄ±cÄ± Paneli";
            homeTitle.textContent  = "KullanÄ±cÄ± Paneli";
            homeDesc.textContent   = "Bu ekran Atify kullanÄ±cÄ±larÄ± iÃ§in. ÅarkÄ±larÄ± gÃ¶rebilir, playlist oluÅŸturabilir ve playlistlerine ÅŸarkÄ± ekleyebilirsin.";
            artistRoleText.textContent = "KullanÄ±cÄ±lar sanatÃ§Ä± ekleyemez.";
            if (artistAdminBox) artistAdminBox.style.display = "none";
        }

        // MenÃ¼de rol bazlÄ± buton gizleme
        document.querySelectorAll("nav button").forEach(btn => {
            const needRole = btn.getAttribute("data-role");
            if (!needRole || needRole === "BOTH") {
                btn.style.display = "inline-block";
            } else if (needRole === "ADMIN" && currentRole !== "ADMIN") {
                btn.style.display = "none";
            } else if (needRole === "USER" && currentRole !== "USER") {
                btn.style.display = "none";
            } else {
                btn.style.display = "inline-block";
            }
        });

        updateUserInfo();
    }

    function enterAs(role) {
        currentRole = role; // "ADMIN" veya "USER"
        // Rol seÃ§im sayfasÄ±nÄ± kapat, home'u aÃ§
        document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
        document.getElementById("page-home").classList.add("active");

        // MenÃ¼ durumlarÄ±nÄ± gÃ¼ncelle
        document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
        document.querySelector('nav button[data-page="home"]').classList.add("active");

        applyRoleToUI();
        setStatus(role === "ADMIN" ? "Admin paneline geÃ§tin." : "KullanÄ±cÄ± paneline geÃ§tin.", true);
        // ARTIK BURADA MODAL YOK
    }

    function showPage(pageId, btn) {
        if (!currentRole) {
            setStatus("Ã–nce Admin / KullanÄ±cÄ± olarak giriÅŸ tipini seÃ§.", false);
            return;
        }

        // KullanÄ±cÄ± rolÃ¼ndeyken admin sayfalarÄ±
        if (currentRole !== "ADMIN" && (pageId === "artists" || pageId === "addSong")) {
            setStatus("Bu alan sadece admin iÃ§in.", false);
            return;
        }

        document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
        const pageEl = document.getElementById("page-" + pageId);
        if (pageEl) {
            pageEl.classList.add("active");
        }

        if (btn) {
            document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
        }
    }

    async function apiRequest(path, method = "GET", body = null, withAuth = true) {
        const url = CONFIG.baseUrl + path;
        const options = {
            method,
            headers: { "Content-Type": "application/json" }
        };
        if (withAuth && authToken) {
            options.headers["Authorization"] = "Bearer " + authToken;
        }
        if (body !== null) {
            options.body = JSON.stringify(body);
        }
        try {
            const res = await fetch(url, options);
            const text = await res.text();
            let json;
            try { json = text ? JSON.parse(text) : null; }
            catch (e) { json = text; }
            return { status: res.status, ok: res.ok, data: json };
        } catch (e) {
            setStatus("Ä°stek hatasÄ±: " + e.message, false);
            throw e;
        }
    }

    // === AUTH ===
    async function register() {
        const username = document.getElementById("regUsername").value.trim();
        const email    = document.getElementById("regEmail").value.trim();
        const password = document.getElementById("regPassword").value.trim();

        if (!username || !password) {
            setStatus("KullanÄ±cÄ± adÄ± ve ÅŸifre zorunlu", false);
            return;
        }

        const payload = { username, password, email: email || undefined };
        const { status, ok, data } = await apiRequest(CONFIG.endpoints.register, "POST", payload, false);
        setStatus("KayÄ±t sonucu: HTTP " + status, ok);
        console.log("register response:", data);

        if (ok) {
            showPopup("KayÄ±t baÅŸarÄ±lÄ±");
            showAuthModal("register", username);
        }
    }

    async function login() {
        const username = document.getElementById("loginUsername").value.trim();
        const password = document.getElementById("loginPassword").value.trim();

        if (!username || !password) {
            setStatus("KullanÄ±cÄ± adÄ± ve ÅŸifre zorunlu", false);
            return;
        }

        const payload = { username, password };
        const { status, ok, data } = await apiRequest(CONFIG.endpoints.login, "POST", payload, false);
        setStatus("GiriÅŸ sonucu: HTTP " + status, ok);
        console.log("login response:", data);

        if (ok) {
            const token = data && (data.token || data.jwt || data.jwtToken || data.accessToken);
            if (token) {
                authToken = token;
                loggedUsername = username;
                updateUserInfo();
                showPopup("GiriÅŸ baÅŸarÄ±lÄ±");
                showAuthModal("login", username);
            } else {
                setStatus("Login OK ama token alanÄ± bulunamadÄ± (LoginResponse field ismi farklÄ± olabilir).", false);
            }
        }
    }

    function logout() {
        authToken = null;
        loggedUsername = null;
        updateUserInfo();
        setStatus("Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±");
        showPopup("Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±");
    }

    // === yardÄ±mcÄ±: dizi Ã§Ä±karma ===
    function asArrayMaybe(data) {
        if (Array.isArray(data)) return data;
        if (data && Array.isArray(data.content)) return data.content;
        if (data && Array.isArray(data.songs)) return data.songs;
        return [];
    }

    // === ÅARKILAR ===
    async function getSongs() {
        const { status, ok, data } = await apiRequest(CONFIG.endpoints.songs, "GET", null, true);
        setStatus("ÅarkÄ±lar getirildi: HTTP " + status, ok);

        const list = document.getElementById("songsList");
        const arr = asArrayMaybe(data);

        if (!ok || arr.length === 0) {
            list.textContent = typeof data === "string" ? data : JSON.stringify(data, null, 2);
            return;
        }

        list.innerHTML = "";
        arr.forEach(song => {
            const div = document.createElement("div");
            div.className = "item";

            const title =
                song.name ||          // backend'den gelen alan
                song.title ||
                song.songName ||
                "(isim yok)";

            const id = song.id ?? "";
            const duration = song.duration ?? 0;

            div.innerHTML = `
                <b>${title}</b> ${id !== "" ? "(#"+id+")" : ""}
                <span class="tag">sÃ¼re: ${duration} sn</span>
            `;
            list.appendChild(div);
        });
    }

    // === SANATÃ‡ILAR ===
    async function getArtists() {
        const { status, ok, data } = await apiRequest(CONFIG.endpoints.artists, "GET", null, true);
        setStatus("SanatÃ§Ä±lar getirildi: HTTP " + status, ok);

        const list = document.getElementById("artistsList");
        const arr = asArrayMaybe(data);

        if (!ok || arr.length === 0) {
            list.textContent = typeof data === "string" ? data : JSON.stringify(data, null, 2);
            return;
        }

        list.innerHTML = "";
        arr.forEach(a => {
            const div = document.createElement("div");
            div.className = "item";
            const id = a.id ?? "";
            const name = a.name || "(isim yok)";
            div.innerHTML = `<b>${name}</b> ${id !== "" ? "(#" + id + ")" : ""}`;
            list.appendChild(div);
        });
    }

    async function createArtist() {
        if (currentRole !== "ADMIN") {
            setStatus("SanatÃ§Ä± ekleme sadece admin iÃ§in.", false);
            return;
        }
        const name = document.getElementById("artistName").value.trim();
        if (!name) {
            setStatus("SanatÃ§Ä± adÄ± zorunlu", false);
            return;
        }
        const payload = { name };
        const { status, ok, data } = await apiRequest(CONFIG.endpoints.artists, "POST", payload, true);
        setStatus("SanatÃ§Ä± ekleme sonucu: HTTP " + status, ok);
        console.log("createArtist response:", data);
        if (ok) {
            showPopup("SanatÃ§Ä± eklendi");
            document.getElementById("artistName").value = "";
            getArtists();
        }
    }

    // === PLAYLISTLER ===
    async function getPlaylists() {
        const { status, ok, data } = await apiRequest(CONFIG.endpoints.playlists, "GET", null, true);
        setStatus("Playlistler getirildi: HTTP " + status, ok);

        const list = document.getElementById("playlistsList");
        const arr = asArrayMaybe(data);

        if (!ok || arr.length === 0) {
            list.textContent = typeof data === "string" ? data : JSON.stringify(data, null, 2);
            return;
        }

        list.innerHTML = "";
        arr.forEach(pl => {
            const div = document.createElement("div");
            div.className = "item";
            const id = pl.id ?? "";
            const name = pl.name || "(isim yok)";
            div.innerHTML = `<b>${name}</b> ${id !== "" ? "(#" + id + ")" : ""}`;
            list.appendChild(div);
        });
    }

    async function createPlaylist() {
        const name = document.getElementById("playlistName").value.trim();
        if (!name) {
            setStatus("Playlist adÄ± zorunlu", false);
            return;
        }
        const payload = { name };
        const { status, ok, data } = await apiRequest(CONFIG.endpoints.playlists, "POST", payload, true);
        setStatus("Playlist oluÅŸturma sonucu: HTTP " + status, ok);
        console.log("createPlaylist response:", data);
        if (ok) {
            showPopup("Playlist oluÅŸturuldu");
            document.getElementById("playlistName").value = "";
            getPlaylists();
        }
    }

    async function addSongToPlaylist() {
        const plIdStr = document.getElementById("plIdForSong").value.trim();
        const songIdStr = document.getElementById("plSongId").value.trim();

        if (!plIdStr || !songIdStr) {
            setStatus("Playlist ID ve Song ID zorunlu", false);
            return;
        }

        const path = `${CONFIG.endpoints.playlists}/${Number(plIdStr)}/songs`;
        const payload = { songId: Number(songIdStr) };

        const { status, ok, data } = await apiRequest(path, "POST", payload, true);
        setStatus("Playlistâ€™e ÅŸarkÄ± ekleme sonucu: HTTP " + status, ok);
        console.log("addSongToPlaylist response:", data);
        if (ok) showPopup("ÅarkÄ± playliste eklendi");
    }

    async function getPlaylistContent() {
        const plIdStr = document.getElementById("plIdForGet").value.trim();
        if (!plIdStr) {
            setStatus("Playlist ID zorunlu", false);
            return;
        }
        const path = `${CONFIG.endpoints.playlists}/${Number(plIdStr)}`;
        const { status, ok, data } = await apiRequest(path, "GET", null, true);
        setStatus("Playlist iÃ§eriÄŸi getirildi: HTTP " + status, ok);

        const box = document.getElementById("playlistContent");
        if (!ok || !data) {
            box.textContent = typeof data === "string" ? data : JSON.stringify(data, null, 2);
            return;
        }

        const songsArr = asArrayMaybe(data.songs || data.tracks || data);

        if (songsArr.length === 0) {
            box.textContent = JSON.stringify(data, null, 2);
            return;
        }

        box.innerHTML = "";
        songsArr.forEach(s => {
            const div = document.createElement("div");
            div.className = "item";
            const title =
                s.name ||
                s.title ||
                s.songName ||
                "(isim yok)";
            const id = s.id ?? "";
            div.innerHTML = `<b>${title}</b> ${id !== "" ? "(#" + id + ")" : ""}`;
            box.appendChild(div);
        });
    }

    // === MÃœZÄ°K EKLE (ADMIN) ===
    async function createSong() {
        if (currentRole !== "ADMIN") {
            setStatus("ÅarkÄ± ekleme sadece admin iÃ§in.", false);
            return;
        }

        const title       = document.getElementById("songTitle").value.trim();
        const artistIdStr = document.getElementById("songArtistId").value.trim();
        const durationStr = document.getElementById("songDuration").value.trim();
        const playlistStr = document.getElementById("songPlaylistIds").value.trim();

        if (!title || !artistIdStr) {
            setStatus("ÅarkÄ± adÄ± (name) ve artistId zorunlu", false);
            return;
        }

        let duration = 0;
        if (durationStr) {
            const d = Number(durationStr);
            if (!Number.isNaN(d) && d >= 0) duration = d;
        }

        let playlistIdList = [];
        if (playlistStr) {
            playlistIdList = playlistStr
                .split(",")
                .map(s => s.trim())
                .filter(s => s.length > 0)
                .map(s => Number(s))
                .filter(n => !Number.isNaN(n));
        }

        const payload = {
            name: title,
            artistId: Number(artistIdStr),
            duration: duration,
        };
        if (playlistIdList.length > 0) {
            payload.playlistIdList = playlistIdList;
        }

        const { status, ok, data } = await apiRequest(CONFIG.endpoints.songs, "POST", payload, true);
        setStatus("ÅarkÄ± ekleme sonucu: HTTP " + status, ok);
        console.log("createSong response:", data);
        if (ok) {
            showPopup("ÅarkÄ± eklendi");
            document.getElementById("songTitle").value = "";
            document.getElementById("songArtistId").value = "";
            document.getElementById("songDuration").value = "";
            document.getElementById("songPlaylistIds").value = "";
            getSongs();
        }
    }

    // BaÅŸlangÄ±Ã§ durumu
    setStatus("Rol seÃ§meni bekliyorum...", true);
    updateUserInfo();
</script>

</body>
</html>
